# 虚拟机栈

## 概述

Java的指令是基于栈来设计的。

优点：跨平台、指令集小、编译器容易实现

缺点：性能下降



每个线程在创建时都会创建一个虚拟机栈，内部保存一个个的栈帧（每个栈帧对应一个Java方法调用）

生命周期和线程一致

主管Java程序的运行，保存方法的局部变量、部分结果，并参与方法的调用和返回

栈不存在垃圾回收，存在OOM



`-Xss` 调整栈大小（默认单位是字节）

```bash
# 设置为 1m 的多种方法
-Xss1m
-Xss1024k
-Xss1048576
```

可以控制递归的层数



栈是运行时的单位，堆是存储的单位

## 存储单位

栈帧是基本单位

栈帧是一个内存区块，是一个数据集，维系着方法执行过程中的各种数据信息

栈顶的栈帧对应的是方法叫当前方法，当前方法所在类叫当前类

执行引擎运行的所有字节码指令只针对当前栈帧进行操作



不同线程的栈帧不允许相互引用

如果当前方法1调用了其他方法2，方法2返回之际，当前栈帧会把方法2的执行结果传给前一个栈帧，然后当前栈帧被丢弃

无论是正常返回还是抛异常（不处理的那种异常）返回，栈帧都会被弹出来

## 局部变量表

## 面试题

### 开发时遇到的异常有哪些？

栈可能出现的异常

Java虚拟机规范允许Java栈的大小是动态的或者是固定不变的。
>如果采用固定大小的Java虚拟机栈，那每一个线程的Java虚拟机栈容量可以在线程创建的时候独立选定。如果线程请求分配的栈容量超过Java虚拟机栈允许的最大容量，Java虚拟机将会抛出一个stackoverflowError 异常。
>
>如果Java虚拟机栈可以动态扩展，并且在尝试扩展的时候无法申请到足I够的内存，或者在创建新的线程时没有足够的内存去创建对应的虚拟机栈那Java虚拟机将会抛出一个outofMemoryError异常。

